<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template/template.xhtml">

  <ui:param name="managedBean" value="#{invoiceListMB}"></ui:param>

  <ui:define name="content">

    <p:outputPanel id="title">
      <h2 class="title">#{msg['title.page.invoice']}</h2>
    </p:outputPanel>

    <p:outputPanel class="card">

      <h:form id="form">

        <p:toolbar>
          <p:toolbarGroup>
            <p:commandButton value="#{msg['button.new']}" icon="pi pi-plus"
                             process="@this" styleClass="ui-button-success" style="margin-right: .5rem">
            </p:commandButton>
          </p:toolbarGroup>
          <p:toolbarGroup align="right">
            <p:fileUpload mode="simple" skinSimple="true" label="Import" chooseIcon="pi pi-download" disable="true"/>
            <p:commandButton value="Export" icon="pi pi-upload" styleClass="ui-button-help" ajax="false" disable="true">
              <p:dataExporter type="pdf" target="dt-invoices" fileName="invoices"/>
            </p:commandButton>
          </p:toolbarGroup>
        </p:toolbar>

        <p:dataTable id="invoiceTable" widgetVar="dtInvoices" var="item" value="#{managedBean.searchResult}"
                     styleClass="products-table" rowKey="#{item.id}"
                     paginator="true" rows="10" paginatorPosition="bottom"
                     lazy="true" style="margin-top: 1rem;" size="small">

          <f:facet name="header">
            <div>
              <span style="font-weight: bold" class="paddingRight8">#{msg['title.page.invoice']}</span>
              <span class="filter-container ui-input-icon-left"> <i class="pi pi-search"></i>
                        <p:inputText id="globalFilter" onkeyup="if (event.keyCode == 13) PF('dtInvoices').filter()" placeholder="#{msg['button.search']}" value="#{managedBean.filterInvoiceForm.number}"/>
                    </span>
            </div>
          </f:facet>

          <p:column headerText="#{msg['invoice.label.number']}">
            <h:outputText value="#{item.number}"/>
          </p:column>

          <p:column headerText="#{msg['invoice.label.date.entry']}">
            <h:outputText value="#{item.dateEntry}"/>
          </p:column>

          <p:column headerText="#{msg['invoice.label.company']}" width="400">
            <h:outputText value="#{item.company.name}"/>
          </p:column>

          <p:column headerText="#{msg['invoice.label.value']}">
            <h:outputText value="#{item.value}"/>
          </p:column>

          <p:column style="width:3rem;text-align: center">

            <p:commandButton update=":dialogs:invoiceDetail" oncomplete="PF('invoiceDialog').show()"
                             process="@this" icon="pi pi-search" title="View">
              <f:setPropertyActionListener value="#{item}"
                                           target="#{managedBean.selectedInvoice}"/>
            </p:commandButton>
          </p:column>

        </p:dataTable>

      </h:form>

      <h:form id="dialogs">
        <p:dialog header="#{msg['title.page.invoice.detail']}" showEffect="fade" modal="true" widgetVar="invoiceDialog" width="900" height="350">
          <p:outputPanel id="invoiceDetail">
            <p:outputPanel rendered="#{not empty managedBean.selectedInvoice}" class="ui-fluid formgrid grid">

              <p:outputPanel class="field col-12 md:col-3">
                <p:outputLabel for="number" value="#{msg['invoice.label.number']}" class="font-bold"/>
                <p:inputText id="number" value="#{managedBean.selectedInvoice.number}" readonly="true"/>
              </p:outputPanel>

              <p:outputPanel class="field col-12 md:col-3">
                <p:outputLabel for="company" value="#{msg['invoice.label.company']}" class="font-bold"/>
                <p:inputText id="company" value="#{managedBean.selectedInvoice.company.name}" readonly="true"/>
              </p:outputPanel>

              <p:outputPanel class="field col-12 md:col-3">
                <p:outputLabel for="dateEntry" value="#{msg['invoice.label.date.entry']}" class="font-bold"/>
                <p:inputText id="dateEntry" value="#{managedBean.selectedInvoice.dateEntry}" readonly="true">
                  <f:convertDateTime type="localDate" locale="pt_BR" pattern="dd 'de' MMMM 'de' yyyy"/>
                </p:inputText>
              </p:outputPanel>

              <p:outputPanel class="field col-12 md:col-3">
                <p:outputLabel for="value" value="#{msg['invoice.label.value']}" class="font-bold"/>
                <p:inputText id="value" value="#{managedBean.selectedInvoice.value}" readonly="true">
                  <f:convertNumber type="currency" currencySymbol="R$"/>
                </p:inputText>
              </p:outputPanel>

              <p:outputPanel class="field col-12">
                <p:dataTable id="itemTable" var="item" value="#{managedBean.selectedInvoice.itens}" height="250" width="800"
                             stripedRows="true" size="small" scrollable="true" scrollHeight="250">

                  <p:column headerText="#{msg['invoice.item.label.identification']}">
                    <h:outputText value="#{item.serialNumber}"/>
                  </p:column>

                  <p:column headerText="#{msg['invoice.item.label.type']}">
                    <h:outputText value="#{item.type}"/>
                  </p:column>

                  <p:column headerText="#{msg['invoice.item.label.patrimony.number']}">
                    <h:outputText value="#{item.patrimonyNumber}"/>
                  </p:column>

                  <p:column headerText="#{msg['invoice.item.label.brand']}">
                    <h:outputText value="#{item.brand}"/>
                  </p:column>

                  <p:column headerText="#{msg['invoice.item.label.model']}">
                    <h:outputText value="#{item.model}"/>
                  </p:column>

                  <p:column headerText="#{msg['invoice.item.label.value']}">
                    <h:outputText value="#{item.valueEntry}">
                      <f:convertNumber type="currency" currencySymbol="R$"/>
                    </h:outputText>
                  </p:column>

                </p:dataTable>
              </p:outputPanel>
            </p:outputPanel>
          </p:outputPanel>

          <f:facet name="footer">
            <p:commandButton value="#{msg['button.cancel']}" icon="pi pi-times" onclick="PF('invoiceDialog').hide()"
                             class="ui-button-secondary" type="button"/>
          </f:facet>
        </p:dialog>

      </h:form>
    </p:outputPanel>

  </ui:define>

</ui:composition>