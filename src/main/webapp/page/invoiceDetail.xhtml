<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:wcc="http://xmlns.jcp.org/jsf/composite/components"
                template="/WEB-INF/template/template.xhtml">

  <ui:param name="managedBean" value="#{invoiceDetailMB}"></ui:param>
  <ui:param name="model" value="#{managedBean.invoice}"></ui:param>

  <ui:define name="titulo">#{msg['title.page.invoice.new']}</ui:define>

  <ui:define name="content">

    <p:outputPanel class="card container">

      <h:form id="form">

        <p:outputPanel id="invoiceDetail" class="ui-fluid formgrid grid">
          <p:outputPanel class="field col-12 md:col-3">
            <p:outputLabel for="number" value="#{msg['invoice.label.number']}" class="font-bold"/>
            <p:inputText id="number" value="#{managedBean.invoice.number}" required="true"/>
          </p:outputPanel>

          <p:outputPanel class="field col-12 md:col-3">
            <p:outputLabel for="company" value="#{msg['invoice.label.company']}" class="font-bold"/>
            <p:selectOneMenu id="company" value="#{managedBean.invoice.company}" required="true">
              <f:selectItem itemLabel="Select One" itemValue=""/>
              <f:selectItems value="#{managedBean.companies}" var="item" itemLabel="#{item.name}" itemValue="#{item}"/>
            </p:selectOneMenu>
          </p:outputPanel>

          <p:outputPanel class="field col-12 md:col-3">
            <p:outputLabel for="dateEntry" value="#{msg['invoice.label.date.entry']}" class="font-bold"/>
            <p:inputText id="dateEntry" value="#{managedBean.invoice.dateEntry}" required="true">
              <f:convertDateTime type="localDate" locale="pt_BR" pattern="dd 'de' MMMM 'de' yyyy"/>
            </p:inputText>
          </p:outputPanel>

          <p:outputPanel class="field col-12 md:col-3">
            <p:outputLabel for="value" value="#{msg['invoice.label.value']}" class="font-bold"/>
            <p:inputText id="value" value="#{managedBean.invoice.value}" readonly="true">
              <f:convertNumber type="currency" currencySymbol="R$"/>
            </p:inputText>
          </p:outputPanel>

          <p:outputPanel class="field col-12">
            <p:dataTable id="itemTable" var="item" value="#{managedBean.invoice.itens}" height="250" width="700"
                         stripedRows="true" size="small" scrollable="true" scrollHeight="250"
                         editable="true">

              <f:facet name="header">
                <div>
                  <p:commandButton value="Adicionar Item" update="itemTable" process="@this" styleClass="width140" actionListener="#{managedBean.addItem}"/>
                </div>

              </f:facet>

              <p:row style="visibility: collapse;"/>

              <p:column headerText="#{msg['invoice.item.label.identification']}" width="200">
                <h:outputText value="#{item.serialNumber}"/>
              </p:column>

              <p:column headerText="#{msg['invoice.item.label.type']}" width="100">
                <h:outputText value="#{item.type}"/>
              </p:column>

              <p:column headerText="#{msg['invoice.item.label.patrimony.number']}" width="200">
                <h:outputText value="#{item.patrimonyNumber}"/>
              </p:column>

              <p:column headerText="#{msg['invoice.item.label.brand']}" width="100">
                <h:outputText value="#{item.brand}"/>
              </p:column>

              <p:column headerText="#{msg['invoice.item.label.model']}">
                <h:outputText value="#{item.model}"/>
              </p:column>

              <p:column headerText="#{msg['invoice.item.label.value']}" width="120">
                <h:outputText value="#{item.valueEntry}">
                  <f:convertNumber type="currency" currencySymbol="R$"/>
                </h:outputText>
              </p:column>

              <p:column>
                <p:commandButton class="ui-button-warning rounded-button" icon="pi pi-trash" process="@this">
                  <f:setPropertyActionListener value="#{product}" target="#{managedBean.selectedProduct}"/>
                </p:commandButton>
              </p:column>

            </p:dataTable>
          </p:outputPanel>

          <p:outputPanel class="field col-12">
            <p:outputPanel class="ui-fluid formgrid grid">
              <p:commandButton id="buttonSave" value="#{msg['button.save']}" icon="pi pi-check" actionListener="#{managedBean.save}" process="@this" class="width140 m-2"/>
              <p:commandButton value="#{msg['button.cancel']}" icon="pi pi-times" action="/page/invoiceList?faces-redirect=true"
                               process="@this"  class="ui-button-secondary width140 m-2"/>
            </p:outputPanel>
          </p:outputPanel>

        </p:outputPanel>

        <p:defaultCommand target="dummy"/>
        <p:commandButton id="dummy" process="@none" global="false" style="display:none;"/>
      </h:form>

    </p:outputPanel>

  </ui:define>

</ui:composition>